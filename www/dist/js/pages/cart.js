var kupavnaBasket=function(){var t=function(t,a){var o=kupavnaCart.getCartCount(cart.state.products),c=$(".header").data("units-mode");a?t.find(".count input").val(a.count):t.fadeOut(300,function(){t.remove()}),"kg"==c?$("#cart__total-count").html(cart.formatPrice(o.totalPackagingPc)+" шт"):$("#cart__total-count").html(cart.formatPrice(o.count)+" шт"),$("#cart__total-packaging").html(cart.formatPrice(o.totalPackaging)+" кг"),$("#cart__total-sale").html(cart.formatPrice(o.totalSale)+" руб"),$("#cart__total-price").html(cart.formatPrice(o.price)+" руб"),a&&(t.find(".total").html(cart.formatPrice(a.count*a.price)+" руб"),"kg"==c&&(a.count*a.packaging==0?t.find(".total-desc").html("за "+cart.formatPrice(a.count)+" шт"):t.find(".total-desc").html("за "+cart.formatPrice(a.count*a.packaging)+" кг")))},a=function(){$("body").on("click",".cart-product .up",function(){var a=$(this).closest(".cart-product"),o=cart.getProduct(a.data("product")),c=o.in_stock?o.in_stock:1e6,e=!0;(o.count+1<=c||e)&&(c-o.count<=0&&!a.hasClass("notice-none")&&(a.hasClass("notice-none")||a.addClass("notice-none"),kupavnaApp.appendNotice(a)),cart.add(o,1,function(c){t(a,o)}))})},o=function(){$("body").on("click",".cart-product .remove",function(){var t=$(this).closest(".cart-product");cart.getProduct(t.data("product"));t.find(".remove-verification").css("left","1007px").addClass("arrow-right").fadeIn("fast")})},c=function(){$("body").on("click",".cart-product .down",function(){var a=$(this).closest(".cart-product"),o=cart.getProduct(a.data("product")),c=a.find(".remove-verification");o.count<=1?(c.removeClass("arrow-right"),c.css("left","175px").fadeIn("fast")):cart["delete"](o,1,function(o){t(a,o)})})},e=function(){$("body").on("change keyup",".cart-product .count input",function(){var a=$(this).closest(".cart-product"),o=cart.getProduct(a.data("product")),c=a.find(".remove-verification"),e=Number(this.value),r=o.in_stock,n=!0;e<=0?(c.removeClass("arrow-right"),c.css("left","175px").fadeIn("fast")):e>r&&!n?cart.set(o,r,function(c){t(a,o)}):(r-o.count<=0&&!a.hasClass("notice-none")&&(a.hasClass("notice-none")||a.addClass("notice-none"),kupavnaApp.appendNotice(a)),cart.set(o,e,function(c){t(a,o)}))})},r=function(){$(document).mouseup(function(t){var a=$(".remove-verification");0===a.has(t.target).length&&a.fadeOut("fast")}),$("body").on("click",".remove-verification .refuse",function(){var a=$(this).closest(".cart-product"),o=cart.getProduct(a.data("product"));cart.set(o,o.count,function(c){t(a,o),$(".remove-verification").fadeOut("fast")})})},n=function(){$("body").on("click",".remove-verification .confirm",function(){var a=$(this).closest(".cart-product"),o=cart.getProduct(a.data("product"));cart["delete"](o,o.count,function(o){t(a,o),$(".remove-verification").fadeOut("fast")}),i()})},i=function(){var t=cart.state.products.length,a=$(".order .button");t>0&&a.hasClass("disabled")&&a.removeClass("disabled"),0!=t||a.hasClass("disabled")||a.addClass("disabled"),0==t?setTimeout(function(){$(".cart-empty").show()},500):$(".cart-empty").hide()};return{init:function(){i(),a(),c(),o(),e(),r(),n(),$("#createOrder").on("click",function(t){t.preventDefault();var a=cart.state.products.length;a>0&&$.ajax({url:this.href,data:"",async:!1,dataType:"JSON",method:"POST"}).success(function(t){0==t.error_code?($("body").css("overflow","hiden").append('<div style="width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.5);position: absolute; top: 0; left: 0; z-index: 1000;">    </div>>'),Cookies.remove("cart",{path:"/"}),window.location.href="/lk/profile#panel2"):$("body").prepend('<div class="callout warning" style="position: fixed; top: 0; right: 0; z-index: 1000;"><h5>'+t.error_messages.system_errors+"</h5></div>")}).error(function(){$("body").prepend('<div class="callout warning" style="position: fixed; top: 0; right: 0; z-index: 1000;"><h5>Произошла ошибка.</h5><p>Повторите попытку позднее. В случае повторения ошибки свяжитесь с <a href="mailto:info@reaktivy.ru">администрацией</a></p></div>')}).complete(function(){})})}}}();$(document).ready(function(){kupavnaBasket.init()});